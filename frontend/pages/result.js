import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import Link from 'next/link'

import {  useState, useEffect, useCallback, memo } from "react";

const Result = memo(({spots}) => {
  const [start, setStart] = useState(false);
  const [index, setIndex] = useState(0);

  const rouletteContents1 = [
    "富士山",
    "ディズニーランド",
    "マクドナルド札幌店",
    "東京駅",
    "読売らんど",
    "お台場",
    "駒場東大前駅",
    "沖ノ鳥島"
  ];

  const rouletteContents2 = [
    "東京ドーム",
    "佐賀空港",
    "択捉島",
    "鎌倉",
    "葛西臨海公園",
    "楽天本社",
    "富岡製糸場",
    "ラーメン二郎三田本店",
    "鴨川シーワールド"
  ];

  //ボタンの文言を変更する処理
  const startRoulette = useCallback(() => {
    setStart(!start);
  }, [start]);

  //ルーレットを回す処理
  useEffect(() => {
    if (!start) {
      const interval = setInterval(() => {
        setIndex((oldIndex) => {
          if (oldIndex < spots["spot"].length - 1) return oldIndex + 1;
          return 0;
        });
      }, 50);//ルーレットの中身を切り替える速度
      return () => clearInterval(interval);
    } else if (start) {
      return () => clearInterval();
    }
  }, [start]);

  return (
    <div className={styles.container}>
        <Head>
        <title>何が出るかな</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/tabigacha_logo.svg" />
      </Head>
        <div className={styles.main}>
        <p className='menu'>行き先は・・・</p>
      <div className={styles.content}>
        {/* <p className='item'>{rouletteContents1[index]}</p>//結果として表示される文言
        <p className='item'>{rouletteContents2[index]}</p> */}
        <p className='result'>{spots["spot"][index].name}</p>
        {/* {spots.map((spot, index) => {
          return (
            <div key={spot.name} className='item'>
                <p>{spots[index].name}</p>
            </div>
        )})} */}
      </div>
      <button className='btn' type="button" onClick={startRoulette}>
        {start ? "スタート" : "ストップ"}
      </button>
      <Link href="/">
        <button className='btn'>戻る</button>
      </Link>
        </div>
    </div>
  );
});

export default Result

export async function getServerSideProps(context) {
    const queryParams = new URLSearchParams(context.query).toString();
    const res = await fetch(`https://raw.githubusercontent.com/tyukei/jason_rakuten/main/spotdata${queryParams}.json`)
    const spots = await res.json()
    return { props: { spots } }
  }